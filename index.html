<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>■ 零知识协议激活 ■</title>
  <style>
    :root {
      --neon-purple: #bc13fe;
      --cipher-text: #0f0;
      --scan-speed: 1.5s;
      --flicker-speed: 0.01s;
    }

    /* CRT 修复版样式 */
    body {
      background: #001100;
      filter: url(#crt-filter);
      box-shadow: inset 0 0 10rem rgba(0,30,0,0.8);
      height: 100vh;
      overflow: hidden;
      font-family: monospace;
      position: relative;
    }

    /* 扫描线层修复 */
    .scanline-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        to bottom,
        transparent 50%,
        rgba(0, 30, 0, 0.3) 51%,
        transparent 51%
      );
      background-size: 100% 4px;
      animation: scanline var(--scan-speed) linear infinite;
      pointer-events: none;
      z-index: 999;
    }

    .protocol-layer {
      color: var(--cipher-text);
      padding: 2rem;
      border: 1px solid var(--neon-purple);
      margin: 2rem auto;
      max-width: 800px;
      text-shadow: 0 0 10px var(--neon-purple);
    }

    @keyframes scanline {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100%); }
    }
  </style>
</head>
<body>
  <!-- CRT 效果 -->
  <svg style="position:absolute;width:0;height:0">
    <filter id="crt-filter">
      <feOffset dx="1" dy="0">
        <animate attributeName="dx" values="0;1;0" dur="5s" repeatCount="indefinite"/>
      </feOffset>
      <feOffset dx="-1" dy="1">
        <animate attributeName="dx" values="0;-1;0" dur="7s" repeatCount="indefinite"/>
      </feOffset>
      <feTurbulence baseFrequency="0.5"/>
    </filter>
  </svg>

  <div class="scanline-overlay"></div>

  <!-- 协议内容 -->
  <div class="protocol-layer">
    <h2>■ 初级协议：矩阵脱壳 ■</h2>
    <pre>4pml44CQ5Y2D5LiN5piv5Zyo6K+75Y+W5LqG5LiA56eN44CR
4pml4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo</pre>
    <input type="text" id="phase1" placeholder="输入SHA-256哈希值">
  </div>

  <div class="protocol-layer" id="phase2" style="display:none">
    <h2>■ 中级协议：离散对数挑战 ■</h2>
    <pre id="dlpParams"></pre>
    <input type="text" id="dlpProof" placeholder="输入知识证明（格式：c,s）">
  </div>

  <div class="protocol-layer" id="zkpSection" style="display:none">
    <h3>■ 最终协议：Schnorr零知识证明 ■</h3>
    <div id="zkpChallenge"></div>
    <input type="text" id="zkpResponse" placeholder="输入证明响应（十六进制）">
    <button onclick="validateZKP()">最终验证</button>
  </div>

  <div id="finalArchive" class="protocol-layer" style="display:none">
    <!-- 档案数据 -->
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script>
    // 修复后的验证逻辑
    const phase1 = {
      cipher: '4pml44CQ5Y2D5LiN5piv5Zyo6K+75Y+W5LqG5LiA56eN44CR4pml4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo4pmo',
      secret: '平成三冠达成密钥'
    }

    document.getElementById('phase1').addEventListener('input', function(e) {
      const hash = CryptoJS.SHA256(CryptoJS.enc.Base64.parse(phase1.cipher));
      if(hash.toString(CryptoJS.enc.Hex) === e.target.value.toLowerCase()) {
        document.getElementById('phase2').style.display = 'block';
        initDLPChallenge();
      }
    });

    // 修复后的BigInt处理
    function initDLPChallenge() {
      const hour = new Date().getHours();
      const dlpConfig = {
        p: 0x8df64a8f4d96f6d5ecbe45c5b721fc47e46a1b2932cd6b9f334a0n,
        g: 2n,
        x: BigInt(hour % 12) * 0xbeefn + 0xdeadn,
        get y() { return this.g ** this.x % this.p; }
      };

      document.getElementById('dlpParams').textContent = 
        `p = ${dlpConfig.p.toString(16)}\n` +
        `g = ${dlpConfig.g}\n` +
        `y = ${dlpConfig.y.toString(16)}`;
    }

    // 修复证明验证逻辑
    document.getElementById('dlpProof').addEventListener('input', function(e) {
      const [c, s] = e.target.value.split(',').map(n => BigInt(n));
      const dlpConfig = {
        p: 0x8df64a8f4d96f6d5ecbe45c5b721fc47e46a1b2932cd6b9f334a0n,
        g: 2n,
        y: document.getElementById('dlpParams').textContent.split('\n')[2].split('= ')[1]
      };

      const left = (dlpConfig.g ** s) % dlpConfig.p;
      const right = (dlpConfig.y ** c * dlpConfig.g ** s) % dlpConfig.p;
      
      if(left === right) {
        document.getElementById('zkpSection').style.display = 'block';
      }
    });

    // 修复后的ZKP逻辑
    function validateZKP() {
      const secret = new Date().getDate().toString(16).repeat(3);
      const challenge = CryptoJS.lib.WordArray.random(16).toString();
      const expected = CryptoJS.SHA256(secret + challenge).toString(CryptoJS.enc.Hex);

      if(document.getElementById('zkpResponse').value.toLowerCase() === expected) {
        document.getElementById('finalArchive').innerHTML = `
          <h3>■ 平成三冠完全解密 ■</h3>
          <pre>...（解密内容保持不变）...</pre>
        `;
        document.getElementById('finalArchive').style.display = 'block';
      }
    }
  </script>
</body>
</html>
